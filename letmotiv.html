<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur d'improvisation</title>
    <style>
        /* Général */
        body {
            margin: 0;
            font-family: Helvetica, Arial, sans-serif;
            background-image: url('https://i.postimg.cc/2yG5hbLL/Conference.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #333333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Titre rectangulaire */
        .header {
            background-color: #1E3B6F;
            color: #FFFFFF;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 20px 15px;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
        }

        /* Boîte d'introduction */
        .intro-box {
            width: 90%;
            max-width: 600px;
            margin-top: 80px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            text-align: justify;
            font-size: 14px;
        }

        /* Conteneur principal */
        .container {
            width: 90%;
            max-width: 600px;
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 70px;
            border: 1px solid #1E3B6F;
            border-radius: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            background-color: rgba(255, 255, 255, 0.8);
        }

        /* Barre de progression */
        #progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 20px;
            overflow: hidden;
            position: relative;
        }
        #progress-bar-inner {
            width: 0%;
            height: 100%;
            background-color: #FF0000;
            transition: width 1s linear;
        }

        /* Boutons */
        button, a {
            background-color: #1E3B6F;
            color: #FFFFFF;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 16px;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            cursor: pointer;
            margin: 10px;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        button:hover, a:hover {
            background-color: #2F4A7E;
        }

        /* Texte aléatoire */
        #subject-display {
            font-size: 14px;
            font-weight: bold;
            color: #333333;
            margin-top: 15px;
        }

        /* Vidéos */
        video {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            border: 3px solid #1E3B6F;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Titre de la page -->
    <div class="header">
        Letmotiv | Simulateur d'improvisation en public
    </div>

    <!-- Texte d'introduction -->
    <div class="intro-box">
        <p>Vous voulez évaluer votre niveau en prise de parole en public ? Commencez par faire ce petit exercice avec ce simulateur d'improvisation. 
        Générez un sujet d'improvisation et lancez-vous ! Vous avez 2 minutes top chrono : démarrez en enregistrant la vidéo et elle s'arrêtera au bout de 2 minutes. 
        Ensuite, analysez vos gestes, votre voix, et vos éventuels tics de langage pour mieux comprendre vos points forts et vos axes d'amélioration.</p>
    </div>

    <!-- Contenu principal -->
    <div class="container">
        <!-- Générateur de sujets -->
        <button id="generate-subject-btn">Générateur de sujets d'improvisation</button>
        <div id="subject-display"></div>

        <!-- Vidéo de prévisualisation -->
        <video id="preview" autoplay muted></video>

        <!-- Barre de progression -->
        <div id="progress-bar">
            <div id="progress-bar-inner"></div>
        </div>

        <!-- Boutons d'enregistrement -->
        <div>
            <button id="start-btn">Démarrer l'improvisation</button>
            <button id="stop-btn" disabled>Arrêter l'improvisation</button>
        </div>

        <!-- Texte de statut -->
        <p id="status">Appuyez sur "Démarrer l'improvisation" pour commencer.</p>

        <!-- Vidéo enregistrée -->
        <video id="playback" controls style="display: none;"></video>

        <!-- Lien de téléchargement -->
        <a id="download-link" style="display: none;">Télécharger la vidéo de votre prestation</a>
    </div>

    <script>
        const subjects = [
            "Faire un toast : célébrer un voyage autour du monde",
            "Un pitch improvisé : vendre un parapluie au Sahara",
            "Tu es Marylin Monroe après avoir chanté Happy Birthday au Président",
            "Expliquer à des extraterrestres pourquoi ils devraient visiter la Terre",
            "Convaincre un jury que le chocolat devrait être gratuit pour tout le monde",
            "Présenter votre candidature pour devenir président de la planète Mars",
            "Motiver une équipe avant une grande compétition sportive",
            "Faire un discours de mariage pour un couple improbable",
            "Défendre l'idée de remplacer les réunions par des pique-niques",
            "Inventer une excuse farfelue pour arriver en retard à une réunion",
            "Vendre des lunettes qui permettent de voir dans le passé",
            "Vous êtes un super-héros qui dévoile enfin son identité secrète",
            "Expliquer pourquoi votre réveil est toujours en retard… pas vous",
            "Faire un toast : pour la réussite de la conférence sur le climat",
            "Un détective résolvant une affaire mystérieuse en direct",
            "Vous êtes un dragon et négociez avec des humains pour ne pas brûler leur village",
            "Décrire une situation gênante dans un ascenseur bondé",
            "Convaincre des robots qu'ils devraient prendre des vacances",
            "Proposer un abonnement illimité pour les siestes en entreprise"
        ];

        const subjectDisplay = document.getElementById('subject-display');
        const generateSubjectBtn = document.getElementById('generate-subject-btn');
        generateSubjectBtn.addEventListener('click', () => {
            const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
            subjectDisplay.textContent = randomSubject;
        });

        let mediaRecorder;
        let recordedChunks = [];
        const preview = document.getElementById('preview');
        const playback = document.getElementById('playback');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const statusText = document.getElementById('status');
        const downloadLink = document.getElementById('download-link');
        const progressBarInner = document.getElementById('progress-bar-inner');
        let countdown;

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                preview.srcObject = stream;
                return stream;
            } catch (error) {
                statusText.textContent = 'Erreur : Impossible d\'accéder à la webcam.';
                console.error('Erreur d\'accès à la webcam :', error);
            }
        }

        function startTimer() {
            let timeRemaining = 120;
            progressBarInner.style.width = '0%';
            countdown = setInterval(() => {
                const progress = ((120 - timeRemaining) / 120) * 100;
                progressBarInner.style.width = `${progress}%`;
                timeRemaining--;
                if (timeRemaining <= 0) {
                    clearInterval(countdown);
                    mediaRecorder.stop();
                }
            }, 1000);
        }

        startBtn.addEventListener('click', async () => {
            const stream = await setupCamera();
            if (!stream) return;

            mediaRecorder = new MediaRecorder(stream);
            recordedChunks = [];
            mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) recordedChunks.push(event.data);
            };
            mediaRecorder.onstop = () => {
                const videoBlob = new Blob(recordedChunks, { type: 'video/webm' });
                const videoURL = URL.createObjectURL(videoBlob);
                playback.src = videoURL;
                playback.style.display = 'block';
                downloadLink.href = videoURL;
                downloadLink.download = 'Letmotiv_Improvisation.webm';
                downloadLink.style.display = 'inline-block';
                stream.getTracks().forEach((track) => track.stop());
            };

            mediaRecorder.start();
            statusText.textContent = 'Improvisation en cours...';
            startBtn.disabled = true;
            stopBtn.disabled = false;
            startTimer();
        });

        stopBtn.addEventListener('click', () => {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                statusText.textContent = 'Improvisation terminée.';
                startBtn.disabled = false;
                stopBtn.disabled = true;
                clearInterval(countdown);
            }
        });
    </script>
</body>
</html>
