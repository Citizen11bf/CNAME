<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulateur d'improvisation</title>
  <meta name="description" content="Évaluer et développer rapidement votre niveau en prise de parole en public avec le simulateur d'improvisation Letmotiv.">

  <!-- Import de la police DM SANS et Montserrat depuis Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans&family=Montserrat:wght@700&display=swap"
    rel="stylesheet"
  />

  <!-- Icônes Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />

  <style>
    /* --- GLOBAL --- */
    body {
      margin: 0;
      font-family: 'DM Sans', sans-serif;
      background-color: #ffffff; /* Fond blanc */
      color: #333333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden; /* Empêche le défilement horizontal */
      padding-top: 60px; /* Compense la hauteur du header fixe */
      padding-bottom: 20px; /* Réduit l'espace en bas */
    }

    /* --- HEADER --- */
    .header {
      background-color: #182d84;
      color: #FFFFFF;
      font-size: 16px; /* Police plus petite */
      font-weight: bold;
      text-align: center;
      padding: 10px;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10;
      box-sizing: border-box;
    }
    .header-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      max-width: 100%;
      overflow-wrap: break-word; /* évite débordement si texte trop long */
    }
    
    .header a {
      color: #FFFFFF;
      text-decoration: none;
    }
    .header a:hover {
      text-decoration: none;
    }

    /* --- BARRE DE PROGRESSION --- */
    .progress-container {
      position: fixed;
      top: 60px; /* Juste en dessous du header */
      left: 0;
      width: 100%;
      height: 5px;
      background-color: rgba(24, 45, 132, 0.1); /* Fond léger */
      z-index: 9;
    }
    .progress-bar {
      width: 0%;
      height: 100%;
      background-color: #00a48a;
      transition: width 0.5s ease;
    }

    /* --- BOÎTE D'INTRODUCTION --- */
    .intro-box {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #182d84, #00a48a);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #ffffff;
      z-index: 20;
      animation: fadeIn 1s ease forwards;
    }

    .intro-box h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 2.5rem;
      margin-bottom: 30px;
      animation: slideDown 1s ease forwards;
    }

    .intro-box button {
      background-color: #ffffff;
      color: #182d84;
      font-family: 'DM Sans', sans-serif;
      font-size: 1.2rem;
      border: none;
      border-radius: 25px;
      padding: 15px 30px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s, color 0.3s;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
    }

    .intro-box button:hover {
      background-color: #00a48a;
      color: #ffffff;
      transform: scale(1.05);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideDown {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* --- BOXES : couleur de fond #E2E7E3, centrage, marges --- */
    .box {
      width: 90%;
      max-width: 600px;
      margin: 20px auto; /* centrage horizontal + marge verticale */
      background-color: #E2E7E3; 
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 14px;
      border: 2px solid #eeeeee;
      position: relative;
      display: none; /* Masqué par défaut */
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 1s ease, transform 1s ease; /* Augmentation de la durée des transitions */
    }
    .box.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* --- Header interne des boîtes --- */
    .box-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .back-btn {
      border: none;
      background-color: #808080; /* Gray background */
      color: #FFFFFF; /* White arrow */
      font-size: 16px;
      cursor: pointer;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s, transform 0.3s;
    }
    .back-btn:hover {
      background-color: #505050; /* Dark gray on hover */
      transform: scale(1.1);
    }
    .back-btn:active {
      background-color: #303030; /* Even darker on click */
    }
    .back-btn.hidden-visibility {
      visibility: hidden;
    }

    .box-title {
      font-size: 18px;
      font-weight: bold;
      color: #182d84;
      flex-grow: 1;
      text-align: center;
    }

    .step-indicator {
      width: 40px;
      height: 40px;
      background-color: #182d84;
      color: #FFFFFF;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }

    /* Sous-titres de sections (mode d'emploi, etc.) */
    .section-subtitle {
      font-size: 16px;
      color: #000000;
      font-weight: bold;
      margin: 0 0 10px;
    }

    /* BOX1 : Choix d’objectif */
    .objectives-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 10px; /* Ajouté pour supprimer la marge en bas */
    }
    /* Bouton objectif sélectionné = vert */
    .selected-objective {
      background-color: #00a48a !important;
      color: #ffffff;
    }

    /* Icône de flèche pour navigation */
    /* Styles communs */
    .next-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #182d84; /* Bordure bleue */
      background-color: transparent;
      color: #182d84; /* Flèche bleue */
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s, transform 0.3s;
      margin: 10px auto; /* Centrer horizontalement */
    }
    .next-btn:hover {
      background-color: #00a48a; /* Fond bleu foncé au survol */
      color: #ffffff; /* Flèche blanche au survol */
      transform: scale(1.05); /* Légère augmentation de taille au survol */
    }

    /* Encadré pour l'explication des objectifs de prise de parole*/
    .explanation-box {
      visibility: hidden;    /* pour autoriser la transition */
      opacity: 0;
      transform: translateY(-10px);

      margin-top: 0;
      background-color: #fefefe;
      border: 0 solid #ccc;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      font-size: 14px;
      font-style: italic;
      color: #333;

      transition: border 0.5s ease, opacity 0.5s ease, transform 0.5s ease;
    }
    .explanation-box.show {
      visibility: visible;
      opacity: 1;
      transform: translateY(0);
      border: 2px solid #ccc; /* la bordure passe de 0px à 2px */
    }

    /* BOX2 : Vidéo, enregistrement, etc. */
    .box2 .box-title {
      font-size: 18px;
      font-weight: bold;
      color: #182d84;
    }

    /* Encadré pour afficher les sujets d'improvisation aléatoires*/
    .subject-wrapper {
      margin-top: 10px;
      background-color: #fefefe;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      font-style: italic;
      color: #333;
      display: none; /* caché tant qu'il n'y a pas de sujet */
    }
    .subject-wrapper span {
      font-weight: bold;
    }

    /* Encadré bleu + vidéo */
    .video-box {
      margin: 10px auto;
      border: 3px solid #182d84;
      border-radius: 6px;
      max-width: 500px;
      background-color: #fefefe;
      height: 300px; /* on fixe une hauteur */
      position: relative;
      display: flex;
      justify-content: center; 
      align-items: center;     
      overflow: hidden; /* Pour assurer que le texte ne déborde pas */
    }
    .video-box video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1; /* derrière le texte */
    }

    /* Texte explicatif dans la vidéo box */
    .video-box .video-text {
      position: absolute;
      z-index: 2; /* Au-dessus de la vidéo */
      color: #555;
      font-style: italic;
      font-size: 14px;
      text-align: center;
      padding: 20px;
      pointer-events: none; /* Permet de cliquer sur les boutons en dessous */
    }

    /* Indicateur "Enregistrement en cours" */
    .recording-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 14px;
      color: #ff0000;
      display: none; /* Caché par défaut */
      z-index: 3;
    }
    .recording-indicator .dot {
      height: 10px;
      width: 10px;
      background-color: #ff0000;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }

    /* Décompte avec fond grisé */
    .countdown {
      position: absolute;
      bottom: 10px; /* Positionné en bas */
      right: 10px;  /* Positionné à droite */
      font-size: 24px;
      color: #ffffff;
      display: none;
      z-index: 4;
      background-color: rgba(0, 0, 0, 0.5); /* Fond grisé */
      padding: 5px 10px;
      border-radius: 5px;
    }

    /* Les boutons "Arrêter" et "Récommencer" seront en-dessous de la box */
    .impro-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center; 
      margin-top: 10px;
    }

    /* Classe pour masquer les boutons via display: none */
    .hidden-btn {
      display: none;
    }

    /* Styles pour les boutons bleus dans Box4 */
    .progression-buttons {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .progression-buttons a {
      width: 100%;
      max-width: 300px;
      display: flex;
      align-items: center;
      justify-content: center; /* Centre le contenu horizontalement */
    }

    /* Simplification du Footer - supprimé */
    /* .footer {
      background-color: #182d84;
      color: #FFFFFF;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      width: 100%;
      position: fixed;
      bottom: 0;
      left: 0;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    } */

    /* Encadré pour l'explication */
    .download-section {
      text-align: left;
      margin-bottom: 20px;
    }

    /* Styles pour les boutons */
    button,
    a.btn {
      background-color: #182d84;
      color: #FFFFFF;
      font-family: 'DM Sans', sans-serif;
      font-size: 16px;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      cursor: pointer;
      margin: 5px;
      text-decoration: none;
      transition: background-color 0.3s, transform 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center; /* Centre le contenu verticalement */
      gap: 10px;
    }
    button:hover,
    button:active,
    a.btn:hover,
    a.btn:active {
      background-color: #00a48a;
      transform: translateY(-3px);
    }

    /* Nouveau style pour le cadre blanc des téléchargements dans Box3 */
    .download-buttons {
      margin-top: 20px;
      background-color: #fefefe;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
      display: none; /* Caché par défaut */
      text-align: center;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .download-buttons.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* BOX4 : Partage LinkedIn et Options de Progression */
    .box4-content {
      margin-top: 20px;
      background-color: #fefefe;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    /* BOX4 : Boutons de partage LinkedIn */
    .linkedin-share-button {
      display: inline-flex;
      align-items: center;
      justify-content: center; /* Centre le contenu horizontalement */
      background-color: #0e76a8;
      color: #FFFFFF;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: bold;
      text-decoration: none;
      transition: background-color 0.3s, transform 0.3s;
      cursor: pointer;
      margin: 5px;
      gap: 10px;
    }
    .linkedin-share-button:hover,
    .linkedin-share-button:active {
      background-color: #085a8c;
      transform: translateY(-3px);
    }

    /* Media Queries pour s'assurer que les boîtes ne sont pas cachées par le footer */
    @media (max-height: 600px) {
      .box {
        margin-bottom: 20px; /* Réduit la marge en bas */
      }
    }

    /* Styles pour le message d'erreur */
    .error-message {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }

    /* Styles pour les groupes de formulaires */
    .input-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      width: 48%; /* Pour occuper la moitié de la largeur dans la Box3 */
    }

    .input-group label {
      margin-bottom: 5px;
      font-weight: bold;
      color: #000;
    }

    .input-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }

    .input-group input:focus {
      border-color: #00a48a;
      outline: none;
    }

    /* Conteneur des champs Prénom et Email */
    .download-fields {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 15px;
    }

    /* Centrage horizontal du bouton "Valider" */
    .download-section button {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto; /* Centre le bouton horizontalement */
    }
  </style>
</head>
<body>
  <!-- BOÎTE D'INTRODUCTION -->
  <div class="intro-box" id="intro-box">
    <h1>Entrainez-vous à la prise de parole en public<br>avec le simulateur Letmotiv</h1>
    <button id="start-intro-btn" aria-label="Je commence">Je commence</button>
  </div>

  <!-- HEADER -->
  <div class="header">
    <div class="header-content">
      <!-- L1 : Simulateur d'improvisation en public -->
      <div class="header-l1">
        Simulateur d'improvisation en public
      </div>
      <!-- L2 : by Letmotiv -->
      <div class="header-l2" style="font-size: 14px;">
        by Letmotiv
      </div>
    </div>
  </div>

  <!-- BARRE DE PROGRESSION -->
  <div class="progress-container">
    <div class="progress-bar" id="top-progress-bar"></div>
  </div>

  <!-- BOX1 : Choix d'objectif -->
  <div class="box" id="box1">
    <!-- Header interne de la boîte -->
    <div class="box-header">
      <button class="back-btn hidden-visibility" id="back-btn1" aria-label="Retour à l'objectif">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="box-title">Choisis ton objectif.</div>
      <div class="step-indicator">1/4</div>
    </div>

    <div class="objectives-container">
      <button data-category="convaincre">Convaincre</button>
      <button data-category="inspirer">Inspirer</button>
      <button data-category="lacher-prise">Lâcher prise</button>
      <button data-category="toast">Porter un toast</button>
      <button data-category="repartie">Avoir de la répartie</button>
      <button data-category="vendre">Vendre</button>
      <button data-category="conflit">Gérer un conflit</button>
      <button data-category="diction">Diction</button>
    </div>

    <!-- Message d'erreur dans Box1 -->
    <div id="objective-error" class="error-message" style="display: none;">
      Merci de sélectionner un objectif avant de continuer.
    </div>

    <!-- Encadré pour l'explication -->
    <div class="explanation-box" id="explanation-box"></div>

    <!-- Bouton "Suivant" -->
    <button class="next-btn" id="next-btn1" aria-label="Passer à l'étape suivante">
      <i class="fas fa-arrow-right"></i>
    </button>
  </div>

  <!-- BOX2 : Vidéo, enregistrement, etc. -->
  <div class="box" id="box2">
    <!-- Header interne de la boîte -->
    <div class="box-header">
      <button class="back-btn" id="back-btn2" aria-label="Retour à la sélection d'objectif">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="box-title">Lance ton improvisation&nbsp;!</div>
      <div class="step-indicator">2/4</div>
    </div>

    <!-- Bouton pour générer le sujet d'impro (selon l’objectif sélectionné) -->
    <button id="generate-subject-btn">Générer un sujet aléatoire</button>

    <!-- Cadre blanc pour le sujet -->
    <div id="subject-wrapper" class="subject-wrapper">
      <span id="subject-display"></span>
    </div>

    <!-- Box vidéo avec texte explicatif -->
    <div class="video-box">
      <video id="preview" autoplay muted></video>
      <div class="video-text" id="video-text">
        Ici va s'enregistrer ton improvisation en vidéo. <br> 
        Lorsque tu es prêt, clique sur le bouton "Démarrer ton impro" en-dessous. <br><br>
        NB : ta vidéo est stockée directement sur ton appareil. Aucun enregistrement n'est conservé par Letmotiv. 
      </div>
      <!-- Indicateur "Enregistrement en cours" -->
      <div class="recording-indicator" id="recording-indicator">
        <span class="dot"></span> Enregistrement en cours
      </div>
      <!-- Décompte en temps réel -->
      <div class="countdown" id="countdown">1:59</div>
    </div>

    <!-- Boutons en dessous de l'encart bleu -->
    <div class="impro-actions">
      <button id="start-btn" aria-label="Démarrer l'improvisation">Démarrer ton impro <i class="fas fa-video"></i></button>
      <button id="stop-btn" class="hidden-btn" aria-label="Arrêter l'improvisation">Arrêter ton impro <i class="fas fa-stop"></i></button>
      <button id="restart-btn" class="hidden-btn" aria-label="Récommencer l'improvisation">Récommencer ton impro <i class="fas fa-redo"></i></button>
    </div>

    <!-- Supprimé la barre de progression interne -->
    <!-- Supprimé : <div id="progress-bar">
      <div id="progress-bar-inner"></div>
    </div> -->

    <!-- Message d'erreur dans Box2 -->
    <div id="impro-error" class="error-message" style="display: none;">
      Tu dois réaliser ton improvisation avant de continuer.
    </div>

    <!-- Bouton "Suivant" (désactivé jusqu'à ce que l'impro soit arrêtée) -->
    <button class="next-btn" id="next-btn2" disabled aria-label="Passer à l'étape suivante">
      <i class="fas fa-arrow-right"></i>
    </button>
  </div>

  <!-- BOX4 : Partage LinkedIn et Options de Progression -->
  <div class="box" id="box4">
    <!-- Header interne de la boîte -->
    <div class="box-header">
      <button class="back-btn" id="back-btn4" aria-label="Retour à l'improvisation">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="box-title">Partage ton expérience</div>
      <div class="step-indicator">3/4</div>
    </div>

    <p>
      Encourage d'autres personnes à relever le défi ! Montre ton courage et inspire les autres à s'améliorer en improvisation ! <b>#ChallengeImproLetmotiv</b>
    </p>
    <a
      id="linkedin-share-button"
      href="https://www.linkedin.com/shareArticle?mini=true&url=https://citizen11bf.github.io/simulation-impro/letmotiv.html"
      target="_blank"
      rel="noopener noreferrer"
      class="linkedin-share-button"
      aria-label="Partager sur LinkedIn"
    >
      <i class="fab fa-linkedin"></i> Partager sur LinkedIn
    </a>

    <!-- Nouvelle Section pour la Progression -->
    <div class="progression-buttons">
      <p>Tu souhaites progresser rapidement et efficacement dans la prise de parole en public ?</p>
      <a href="https://alexetpierre.systeme.io/inscription" target="_blank" rel="noopener noreferrer" class="btn" aria-label="S'inscrire à la formation en ligne">
        <i class="fas fa-laptop"></i> Suis notre formation en ligne
      </a>
      <a href="https://www.letmotiv.fr/offres-particulier/coaching-prise-de-parole" target="_blank" rel="noopener noreferrer" class="btn" aria-label="Réserver un coaching">
        <i class="fas fa-chalkboard-teacher"></i> Réserve un coaching
      </a>
    </div>

    <!-- Bouton "Suivant" pour passer à la Box3 (Téléchargement) -->
    <button class="next-btn" id="next-btn4" aria-label="Passer à l'étape suivante">
      <i class="fas fa-arrow-right"></i>
    </button>
  </div>

  <!-- BOX3 : Télécharge et analyse ta prestation -->
  <div class="box" id="box3">
    <!-- Header interne de la boîte -->
    <div class="box-header">
      <button class="back-btn" id="back-btn3" aria-label="Retour au partage et progression">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="box-title">Télécharge et analyse ta prestation</div>
      <div class="step-indicator">4/4</div>
    </div>

    <div class="download-section">
      <h3>Renseigne deux infos pour télécharger ta prestation et une grille d'analyse Letmotiv :</h3>
      
      <div class="download-fields">
        <div class="input-group">
          <label for="prenom">Prénom :</label>
          <input type="text" id="prenom" placeholder="Votre prénom" aria-label="Prénom"/>
        </div>

        <div class="input-group">
          <label for="email">Email :</label>
          <input type="email" id="email" placeholder="Votre email" aria-label="Email"/>
        </div>
      </div>

      <span id="email-error" class="error-message" style="display: none;"></span> <!-- Élément pour le message d'erreur -->

      <div>
        <button id="validate-form-btn" aria-label="Valider les informations">Valider</button>
      </div>
    </div>

    <!-- Cadre blanc pour les boutons de téléchargement (invisible par défaut) -->
    <div class="download-buttons" id="download-buttons">
      <button id="download-video-btn" aria-label="Télécharger la vidéo">
        <i class="fas fa-download"></i> Télécharger la vidéo (mp4)
      </button>
      <button id="download-pdf-btn" aria-label="Télécharger la grille d'évaluation">
        <i class="fas fa-download"></i> Télécharger la grille d'évaluation (pdf)
      </button>
    </div>

    <!-- Bouton "Suivant" supprimé car c'est la dernière étape -->
  </div>

  <!-- FOOTER Supprimé -->
  <!-- <div class="footer">
    by Letmotiv <i class="fas fa-microphone"></i>
  </div> -->

  <!-- SCRIPT -->
  <script>
    /***********************
     * 1) Navigation entre les boxes
     ***********************/
    const boxes = {
      1: document.getElementById('box1'),
      2: document.getElementById('box2'),
      3: document.getElementById('box4'), // Partage LinkedIn
      4: document.getElementById('box3')  // Téléchargement et Analyse
    };

    const nextBtns = {
      1: document.getElementById('next-btn1'),
      2: document.getElementById('next-btn2'),
      3: document.getElementById('next-btn4'), // Ajout du next-btn4 pour Box4
      // 4: Aucun bouton "Suivant" dans Box3 (Téléchargement)
    };

    const backBtns = {
      2: document.getElementById('back-btn2'),
      3: document.getElementById('back-btn4'), // Retour depuis Partage LinkedIn
      4: document.getElementById('back-btn3')  // Retour depuis Téléchargement
    };

    const introBox = document.getElementById('intro-box');
    const startIntroBtn = document.getElementById('start-intro-btn');

    const topProgressBar = document.getElementById('top-progress-bar');

    function updateProgressBar(step) {
      const progress = step * 25; // Chaque étape représente 25%
      topProgressBar.style.width = `${progress}%`;
    }

    function showBox(current, next) {
      if (boxes[current]) boxes[current].classList.remove('active');
      if (boxes[next]) boxes[next].classList.add('active');

      // Mettre à jour la barre de progression
      updateProgressBar(next);

      // Mettre à jour le step-indicator
      const stepIndicators = document.querySelectorAll('.step-indicator');
      stepIndicators.forEach(indicator => {
        const stepText = indicator.textContent.trim();
        const stepNumber = parseInt(stepText.split('/')[0]);
        if (stepNumber === next) {
          indicator.textContent = `${next}/4`;
        }
      });

      // Scroll vers la boîte active en tenant compte du header
      const header = document.querySelector('.header');
      const headerHeight = header ? header.offsetHeight : 0;
      const boxPosition = boxes[next].getBoundingClientRect().top + window.scrollY - headerHeight - 20; // Ajuste la valeur 20 selon ton besoin

      window.scrollTo({
        top: boxPosition,
        behavior: 'smooth'
      });
    }

    // Initialisation de la barre de progression
    updateProgressBar(0);

    // Ajouter des écouteurs pour les boutons "Suivant"
    nextBtns[1].addEventListener('click', () => {
      // Vérifier si un objectif est sélectionné
      const selected = document.querySelector('.objectives-container .selected-objective');
      if (!selected) {
        // Afficher le message d'erreur
        const errorDiv = document.getElementById('objective-error');
        errorDiv.style.display = 'block';
        return;
      }
      showBox(1, 2);
    });
    nextBtns[2].addEventListener('click', () => {
      // Vérifier si l'improvisation est réalisée
      if (nextBtns[2].disabled) {
        // Afficher le message d'erreur personnalisé
        const improErrorDiv = document.getElementById('impro-error');
        improErrorDiv.textContent = "Tu dois réaliser ton improvisation avant de continuer.";
        improErrorDiv.style.display = 'block';
        return;
      }
      showBox(2, 3);
    });
    nextBtns[3].addEventListener('click', () => showBox(3, 4)); // Navigue de Box4 à Box3

    // Aucun bouton "Suivant" dans Box3 (Téléchargement)

    // Ajouter des écouteurs pour les boutons "Retour" uniquement s'ils existent
    if (backBtns[2]) {
      backBtns[2].addEventListener('click', () => showBox(2, 1));
    }
    if (backBtns[3]) {
      backBtns[3].addEventListener('click', () => showBox(3, 2));
    }
    if (backBtns[4]) {
      backBtns[4].addEventListener('click', () => showBox(4, 3));
    }

    // Gestion de la boîte d'introduction
    startIntroBtn.addEventListener('click', () => {
      // Appliquer l'animation de fade-out
      introBox.style.animation = 'fadeOut 0.5s ease forwards';
      
      // Après l'animation, cacher la boîte d'introduction et afficher la Box1
      setTimeout(() => {
        introBox.style.display = 'none';
        boxes[1].classList.add('active');
        updateProgressBar(1);

        // Scroll vers la Box1
        const header = document.querySelector('.header');
        const headerHeight = header ? header.offsetHeight : 0;
        const boxPosition = boxes[1].getBoundingClientRect().top + window.scrollY - headerHeight - 20;

        window.scrollTo({
          top: boxPosition,
          behavior: 'smooth'
        });
      }, 500); // Durée de l'animation fadeOut
    });

    /***********************
     * 2) Explications par catégorie
     ***********************/
    const explanations = {
      convaincre:   "Objectif : essaye de convaincre ton auditoire d’une idée générale.",
      inspirer:     "Objectif : fais un discours inspirant et motive ton public.",
      'lacher-prise': "Objectif : amuse-toi, libère-toi de tes freins et lâche prise.",
      toast:        "Objectif : porter un toast marquant pour célébrer un événement.",
      repartie:     "Objectif : réponds du tac-au-tac et montre ton sens de la répartie.",
      vendre:       "Objectif : fais un argumentaire de vente percutant.",
      conflit:      "Objectif : gère un désaccord ou une tension avec diplomatie.",
      diction:      "Objectif : Améliore ta diction et in fine la clarté de ton discours."
    };

    const txtFilesByCategory = {
      convaincre:   "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/convaincre.txt",
      inspirer:     "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/inspirer.txt",
      'lacher-prise': "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/lacher_prise.txt",
      toast:        "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/toast.txt",
      repartie:     "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/repartie.txt",
      vendre:       "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/vendre.txt",
      conflit:      "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/gerer_un_conflit.txt",
      diction:      "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/diction.txt"
    };

    let subjectsCache = {
      convaincre: null,
      inspirer: null,
      'lacher-prise': null,
      toast: null,
      repartie: null,
      vendre: null,
      conflit: null,
      diction: null
    };

    const objectivesButtons = document.querySelectorAll('.objectives-container button');
    const explanationBox = document.getElementById('explanation-box');
    const header = document.querySelector('.header');
    let currentCategory = null;

    objectivesButtons.forEach(button => {
      button.addEventListener('click', async () => {
        // Bouton sélectionné = vert
        objectivesButtons.forEach(btn => btn.classList.remove('selected-objective'));
        button.classList.add('selected-objective');

        currentCategory = button.dataset.category;
        const explication = explanations[currentCategory] || "";

        // Animer l'explication (bordure + fade)
        explanationBox.textContent = explication;
        explanationBox.classList.add('show');   // applique .show

        // Pré-charger le fichier .txt
        if (subjectsCache[currentCategory] === null) {
          await loadSubjects(currentCategory);
        }

        // Masquer le message d'erreur si visible
        const errorDiv = document.getElementById('objective-error');
        if (errorDiv.style.display === 'block') {
          errorDiv.style.display = 'none';
        }
      });
    });

    async function loadSubjects(category) {
      const filePath = txtFilesByCategory[category];
      if (!filePath) {
        console.error("Catégorie inconnue ou chemin manquant:", category);
        return [];
      }
      try {
        const response = await fetch(filePath);
        if (!response.ok) {
          console.error("Erreur lors du fetch du fichier : " + filePath);
          return [];
        }
        const text = await response.text();
        const lines = text
          .split('\n')
          .map(l => l.trim())
          .filter(l => l.length > 0);
        subjectsCache[category] = lines;
        return lines;
      } catch (err) {
        console.error("Erreur fetch: ", err);
        return [];
      }
    }

    /***********************
     * 3) Gérer le sujet d'impro
     ***********************/
    const generateSubjectBtn = document.getElementById('generate-subject-btn');
    const subjectWrapper = document.getElementById('subject-wrapper');
    const subjectDisplay = document.getElementById('subject-display');
    let currentSubject = "";

    generateSubjectBtn.addEventListener('click', () => {
      if (!currentCategory) {
        // Afficher le message d'erreur si pas d'objectif sélectionné
        const errorDiv = document.getElementById('objective-error');
        errorDiv.style.display = 'block';
        return;
      }
      const subjects = subjectsCache[currentCategory];
      if (!subjects || subjects.length === 0) {
        subjectDisplay.textContent = "Désolé, aucun sujet n'est disponible pour le moment. Veuillez réessayer plus tard.";
        subjectWrapper.style.display = 'block';
        currentSubject = "";
        return;
      }
      const randomIndex = Math.floor(Math.random() * subjects.length);
      currentSubject = subjects[randomIndex];

      subjectDisplay.textContent = currentSubject;
      subjectWrapper.style.display = 'block';
    });

    /***********************
     * 4) Enregistrement vidéo
     ***********************/
    let mediaRecorderInstance;
    let recordedChunks = [];
    const preview = document.getElementById('preview');
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');
    const restartBtn = document.getElementById('restart-btn');
    const validateFormBtn = document.getElementById('validate-form-btn');
    const prenomInput = document.getElementById('prenom');
    const emailInput = document.getElementById('email');
    const downloadButtons = document.getElementById('download-buttons');
    const downloadVideoBtn = document.getElementById('download-video-btn');
    const downloadPdfBtn = document.getElementById('download-pdf-btn');
    const videoText = document.getElementById('video-text'); // Texte dans la video-box
    const recordingIndicator = document.getElementById('recording-indicator');
    const countdownElement = document.getElementById('countdown');

    let countdown;
    let videoURL = "";
    let timerInterval; // Interval pour le décompte en temps réel
    let timeRemaining = 120; // 2 minutes en secondes

    // On factorise la logique de démarrage dans une fonction
    async function startImpro() {
      if (!currentSubject) {
        alert("Merci de sélectionner un objectif et de générer un sujet avant de démarrer.");
        return;
      }
      if (typeof MediaRecorder === 'undefined' || !navigator.mediaDevices?.getUserMedia) {
        alert("Désolé, l'enregistrement vidéo n'est pas supporté par votre navigateur.");
        return;
      }
      if (!confirm("Votre webcam va se lancer pour démarrer l'improvisation. Voulez-vous continuer ?")) {
        return;
      }

      // Afficher le décompte
      startCountdown();
    }

    function startCountdown() {
      let count = 3;
      countdownElement.textContent = count;
      countdownElement.style.display = 'block';

      countdown = setInterval(() => {
        count--;
        if (count > 0) {
          countdownElement.textContent = count;
        } else {
          clearInterval(countdown);
          countdownElement.style.display = 'none';
          initiateRecording();
        }
      }, 1000);
    }

    async function initiateRecording() {
      const stream = await setupCamera();
      if (!stream) return;

      if (!window.MediaRecorder || typeof MediaRecorder.isTypeSupported === 'undefined') {
        alert("Votre navigateur ne supporte pas l'enregistrement vidéo. Essayez Chrome/Firefox.");
        return;
      }

      mediaRecorderInstance = new MediaRecorder(stream);
      recordedChunks = [];

      mediaRecorderInstance.ondataavailable = (event) => {
        if (event.data.size > 0) {
          recordedChunks.push(event.data);
        }
      };

      mediaRecorderInstance.onstop = () => {
        const videoBlob = new Blob(recordedChunks, { type: 'video/mp4' });
        videoURL = URL.createObjectURL(videoBlob);

        // Arrête la webcam
        stream.getTracks().forEach((track) => track.stop());

        // Activer le bouton "Suivant" dans Box2
        nextBtns[2].disabled = false;

        // Afficher "Improvisation terminée." dans la vidéo-box
        videoText.innerHTML = "Improvisation terminée.";
        videoText.style.display = 'block';

        // Masquer le message d'erreur si visible
        const improErrorDiv = document.getElementById('impro-error');
        improErrorDiv.style.display = 'none';

        // Masquer l'indicateur d'enregistrement
        recordingIndicator.style.display = 'none';

        // Arrêter le décompte en temps réel
        clearInterval(timerInterval);
      };

      mediaRecorderInstance.start();

      // Afficher l'indicateur d'enregistrement
      recordingIndicator.style.display = 'flex';

      // Supprime le texte explicatif dans la vidéo box
      videoText.style.display = 'none';

      // Gérer les boutons
      startBtn.classList.add('hidden-btn'); // Masquer "Démarrer"
      stopBtn.classList.remove('hidden-btn'); // Afficher "Arrêter"
      stopBtn.disabled = false;
      restartBtn.classList.add('hidden-btn'); // Masquer "Récommencer"

      // Désactiver le bouton "Suivant" pendant l'impro
      nextBtns[2].disabled = true;

      // Démarrer le décompte en temps réel
      startTimer();
    }

    // Lance la webcam
    async function setupCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        preview.srcObject = stream;
        return stream;
      } catch (error) {
        if (error.name === 'NotAllowedError' || error.name === 'SecurityError') {
          alert("Vous avez refusé l'accès à la webcam ou au micro. Veuillez autoriser l'accès.");
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
          alert("Aucune caméra ou micro détecté(e). Vérifiez vos périphériques.");
        } else {
          alert("Erreur : Impossible d'accéder à la webcam. Vérifiez vos permissions.");
        }
        console.error('Erreur d\'accès à la webcam :', error);
        return null;
      }
    }

    function startTimer() {
      timeRemaining = 120; // Réinitialiser à 2 minutes
      updateCountdownDisplay();

      timerInterval = setInterval(() => {
        timeRemaining--;
        if (timeRemaining >= 0) {
          updateCountdownDisplay();
        }
        if (timeRemaining < 0) {
          clearInterval(timerInterval);
          if (mediaRecorderInstance && mediaRecorderInstance.state === 'recording') {
            mediaRecorderInstance.stop();
            // Afficher le bouton "Récommencer ton impro"
            restartBtn.classList.remove('hidden-btn');
          }
        }
      }, 1000);
    }

    function updateCountdownDisplay() {
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      const formattedTime = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
      countdownElement.textContent = formattedTime;
      countdownElement.style.display = 'block';
    }

    // Bouton "Démarrer ton impro"
    startBtn.addEventListener('click', startImpro);

    // Bouton "Arrêter ton impro"
    stopBtn.addEventListener('click', () => {
      if (mediaRecorderInstance && mediaRecorderInstance.state === 'recording') {
        mediaRecorderInstance.stop();
        clearInterval(countdown);
        clearInterval(timerInterval);

        stopBtn.classList.add('hidden-btn'); // Masquer "Arrêter"
        stopBtn.disabled = true;
        restartBtn.classList.remove('hidden-btn'); // Afficher "Récommencer"

        // Masquer l'indicateur d'enregistrement
        recordingIndicator.style.display = 'none';
      }
    });

    // Bouton "Recommencer ton impro"
    restartBtn.addEventListener('click', () => {
      // Relancer simplement la fonction startImpro()
      restartBtn.classList.add('hidden-btn'); // Masquer "Récommencer"
      videoText.innerHTML = "Ici va s'enregistrer ton improvisation en vidéo. <br> Lorsque tu es prêt, clique sur le bouton \"Démarrer ton impro\" en-dessous. <br><br> NB : ta vidéo est stockée directement sur ton appareil. Aucun enregistrement n'est conservé par Letmotiv.";
      videoText.style.display = 'block';
      startImpro();
    });

    /***********************
     * 5) Validation du formulaire et Affichage des Boutons de Téléchargement
     ***********************/
    validateFormBtn.addEventListener('click', () => {
      const prenomValue = prenomInput.value.trim();
      const emailValue = emailInput.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Regex pour la validation de l'email
      const emailError = document.getElementById('email-error'); // Élément du message d'erreur

      let valid = true;

      // Réinitialiser le message d'erreur
      emailError.textContent = "";
      emailError.style.display = 'none';

      // Validation du prénom
      const prenomRegex = /^[A-Za-zÀ-ÿ '-]+$/; // Autorise les lettres, accents, espaces, apostrophes et tirets
      if (!prenomValue || !prenomRegex.test(prenomValue)) {
        alert("Veuillez entrer un prénom valide sans chiffres ni caractères spéciaux.");
        return;
      }

      // Validation de l'email
      if (!emailValue) {
        alert("Merci de renseigner votre email pour continuer.");
        return;
      }

      if (!emailRegex.test(emailValue)) {
        emailError.textContent = "Veuillez entrer une adresse email valide.";
        emailError.style.display = 'block';
        valid = false;
      }

      if (!valid) {
        return;
      }

      // Afficher les boutons de téléchargement dans le cadre blanc
      downloadButtons.classList.add('show');

      // Activer le bouton "Suivant" pour passer à la box4 (Téléchargement)
      nextBtns[3].disabled = false;
    });

    // Téléchargement de la vidéo
    downloadVideoBtn.addEventListener('click', () => {
      if (!videoURL) {
        alert("La vidéo n'est pas encore prête ou pas enregistrée.");
        return;
      }
      const link = document.createElement('a');
      link.href = videoURL;
      link.download = 'Letmotiv_Improvisation.mp4';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // Téléchargement du PDF
    downloadPdfBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.href = "https://drive.google.com/uc?export=download&id=1pKif7hwkdSQRXLv6uoSQawCs3DIIcb70";
      link.download = "Questions_Evaluation.pdf";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    /***********************
     * 6) Navigation Séquentielle des Boîtes
     ***********************/
    // Cette logique est déjà gérée par les écouteurs "Suivant" et "Retour"
    // Assure-toi que les boutons "Suivant" sont activés/désactivés selon les besoins

    /***********************
     * 7) Gestion des flèches de navigation pour les boîtes
     ***********************/
    // Aucun code supplémentaire n'est nécessaire ici car la navigation est gérée par les boutons "Suivant" et "Retour"

    /***********************
     * 8) Mise à jour de la barre de progression
     ***********************/
    // Cette fonctionnalité est déjà intégrée dans la fonction showBox()
  </script>
</body>
</html>
