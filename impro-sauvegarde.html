<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulateur d'improvisation</title>
  <meta name="description" content="Évaluer et développer rapidement votre niveau en prise de parole en public avec le simulateur d'improvisation Letmotiv.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Général */
    body {
      margin: 0;
      font-family: Helvetica, Arial, sans-serif;
      background-image: url('https://i.postimg.cc/2yG5hbLL/Conference.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: #333333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden; /* Empêcher le défilement horizontal */
    }

    /* Titre rectangulaire */
    .header {
      background-color: #1E3B6F;
      color: #FFFFFF;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10;
      word-break: break-word;
      padding-left: 20px;
      padding-right: 20px;
      box-sizing: border-box;
    }

    /* Boîte d'introduction */
    .intro-box {
      width: 90%;
      max-width: 600px;
      margin-top: 80px;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 14px;
      border: 2px solid #cccccc;
    }

    .intro-box h3 {
      margin-top: 0;
    }
    .objectives-container {
      display: flex;
      flex-wrap: wrap; /* sur plusieurs lignes si petit écran */
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }

    /* Conteneur principal */
    .container {
      width: 90%;
      max-width: 600px;
      margin-top: 20px;
      margin-bottom: 10px; /* Ajout d'espace en bas */
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 14px;
      border: 2px solid #cccccc;
    }

    /* Barre de progression */
    #progress-bar {
      width: 100%;
      height: 10px;
      background-color: #e0e0e0;
      border-radius: 5px;
      margin-top: 10px;
      margin-bottom: 10px;
      overflow: hidden;
      position: relative;
      border: 2px solid #cccccc;
    }

    #progress-bar-inner {
      width: 0%;
      height: 100%;
      background-color: #00a48a;
      transition: width 0.5s linear;
    }

    /* Boutons */
    button, a {
      background-color: #1E3B6F;
      color: #FFFFFF;
      font-family: Helvetica, Arial, sans-serif;
      font-size: 16px;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      cursor: pointer;
      margin: 5px; /* si plusieurs boutons s'enchaînent */
      text-decoration: none;
      transition: background-color 0.3s, transform 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    button:hover, button:active, a:hover, a:active {
      background-color: #00a48a;
      transform: translateY(-3px);
    }

    /* Vidéos */
    video {
      width: 100%;
      max-width: 500px;
      margin: 20px auto;
      border: 3px solid #1E3B6F;
      border-radius: 6px;
    }

    /* Boîte de partage sur les réseaux sociaux */
    .box-partage-RS {
      width: 90%;
      max-width: 600px;
      margin-top: 10px;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 14px;
      border: 2px solid #cccccc;
    }

    /* Footer engageant */
    .footer {
      background-color: #1E3B6F;
      color: #FFFFFF;
      font-size: 16px;
      text-align: center;
      padding: 20px;
      width: 100%;
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    .footer-buttons a {
      display: inline-block;
      background-color: #FFFFFF;
      color: #1E3B6F;
      border: 2px solid #1E3B6F;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: bold;
      text-decoration: none;
      transition: background-color 0.3s, color 0.3s, transform 0.3s;
    }
    .footer-buttons a:hover, .footer-buttons a:active {
      background-color: #00a48a;
      color: #FFFFFF;
      transform: translateY(-3px);
    }

    /* Masqué initialement */
    .hidden {
      display: none;
    }

    /* Section formulaire (Prénom / Email / PDF) */
    .download-section {
      margin-top: 20px;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .download-section label {
      display: block;
      margin: 10px 0 5px;
    }
    .download-section input {
      padding: 8px;
      font-size: 14px;
      margin-bottom: 10px;
      width: 80%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    /* Pour le sujet choisi */
    #subject-display {
      margin-top: 10px;
      font-weight: bold;
      min-height: 40px;
    }
  </style>
</head>
<body>
  <!-- Titre de la page -->
  <div class="header">
    Letmotiv <i class="fas fa-microphone"></i> Simulateur d'improvisation en public
  </div>

  <!-- Box d'introduction : 7 objectifs -->
  <div class="intro-box">
    <h3>Quel est ton objectif&nbsp;?</h3>
    <div class="objectives-container">
      <button data-category="convaincre">Convaincre</button>
      <button data-category="inspirer">Inspirer</button>
      <button data-category="lacher-prise">Lâcher prise</button>
      <button data-category="toast">Porter un toast</button>
      <button data-category="repartie">Avoir de la répartie</button>
      <button data-category="vendre">Vendre</button>
      <button data-category="conflit">Gérer un conflit</button>
    </div>
  </div>
  
  <!-- Contenu principal -->
  <div class="container">
    <!-- Affichage du sujet (selon la catégorie) -->
    <div id="subject-display"></div>

    <video id="preview" autoplay muted></video>

    <div id="progress-bar">
      <div id="progress-bar-inner"></div>
    </div>

    <div>
      <button id="start-btn"><i class="fas fa-video"></i> Démarrer l'improvisation</button>
      <button id="stop-btn" disabled><i class="fas fa-stop"></i> Arrêter l'improvisation</button>
    </div>
    <p id="status">Choisissez d'abord un objectif, puis démarrez l'improvisation.</p>

    <!-- Vidéo enregistrée (lecture) -->
    <video id="playback" controls style="display: none;"></video>

    <!-- Lien de téléchargement de la vidéo (bloqué derrière la validation) -->
    <a id="download-link" style="display: none;"><i class="fas fa-download"></i> Télécharger la vidéo de votre prestation</a>

    <!-- Formulaire prénom + email + bouton PDF (apparaît après l'arrêt) -->
    <div id="download-section" class="download-section hidden">
      <h3>Pour accéder à votre vidéo, merci de renseigner :</h3>
      <label for="prenom">Prénom :</label>
      <input type="text" id="prenom" placeholder="Votre prénom"/>

      <label for="email">Email :</label>
      <input type="email" id="email" placeholder="Votre email"/>

      <div>
        <button id="validate-form-btn">Valider</button>
      </div>

      <!-- Bouton pour télécharger le PDF (questions d'évaluation) -->
      <div>
        <button id="download-pdf-btn">Télécharger le PDF d'évaluation</button>
      </div>
    </div>
  </div>

  <!-- Boîte de partage sur les réseaux sociaux -->
  <div class="box-partage-RS" id="box-partage-RS" style="display: none;">
    <p>
      Partagez votre expérience et encouragez d'autres personnes à relever le défi. <br>
      Montrez votre courage et inspirez les autres à s'améliorer en improvisation !<br><b>#ChallengeImproLetmotiv</b>
    </p>
    <a id="linkedin-share-button" href="https://www.linkedin.com/shareArticle?mini=true&url=https://citizen11bf.github.io/simulation-impro/letmotiv.html"
       target="_blank" class="linkedin-share-button">
       <i class="fab fa-linkedin"></i> Partager sur LinkedIn
    </a>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Vous souhaitez progresser rapidement et efficacement dans la prise de parole en public ?</p>
    <div class="footer-buttons">
      <a href="https://www.letmotiv.fr/offres-particulier/coaching-prise-de-parole" target="_blank">
        <i class="fas fa-chalkboard-teacher"></i> Réservez un coaching Letmotiv
      </a>
      <a href="https://alexetpierre.systeme.io/799d7fa4" target="_blank">
        <i class="fas fa-laptop"></i> Suivre la formation en ligne Letmotiv
      </a>
    </div>
  </div>

  <!-- Script principal -->
  <script>
    /* ========== Vérif compatibilité navigateur ========== */
    const statusText = document.getElementById('status');
    if (typeof MediaRecorder === 'undefined' || !navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      statusText.textContent = "Désolé, l'enregistrement vidéo n'est pas supporté par votre navigateur. Veuillez utiliser un navigateur plus récent ou un autre appareil.";
      document.getElementById('start-btn').disabled = true;
      document.getElementById('stop-btn').disabled = true;
    }

    /* ========== Sujets par catégorie ========== */
    const subjectsByCategory = {
      convaincre: [
        "Convaincre un jury que le chocolat devrait être gratuit",
        "Convaincre un investisseur de financer votre machine à remonter le temps",
        "Convaincre des touristes de vous suivre dans une visite improvisée"
      ],
      inspirer: [
        "Faire un discours inspirant pour des élèves diplômés",
        "Motiver une équipe avant une grande compétition sportive",
        "Faire un discours pour encourager des bénévoles"
      ],
      "lacher-prise": [
        "Improviser une danse absurde et l'assumer pleinement",
        "Raconter la blague la plus nulle possible comme un chef-d'oeuvre",
        "Décrire un rêve complètement loufoque que vous venez de faire"
      ],
      toast: [
        "Faire un toast pour célébrer un voyage autour du monde",
        "Faire un discours de mariage pour un couple improbable",
        "Prononcer un toast hilarant pour l'anniversaire d'un ami imaginaire"
      ],
      repartie: [
        "Répondre du tac-au-tac à un collègue qui vous accuse d'être en retard",
        "Gérer des remarques ironiques et garder le sourire",
        "Retourner un compliment ironique en éloge sincère"
      ],
      vendre: [
        "Vendre un parapluie au Sahara",
        "Vendre des lunettes qui permettent de voir dans le passé",
        "Vendre une horloge qui tourne à l'envers"
      ],
      conflit: [
        "Négocier avec des extraterrestres pour sauver la Terre",
        "Vous êtes un dragon qui négocie avec des humains pour ne pas brûler leur village",
        "Défendre l'idée de remplacer les réunions par des pique-niques face à des collègues sceptiques"
      ]
    };

    // Gestion du clic sur les 7 boutons : affichage d'un sujet aléatoire
    const objectivesButtons = document.querySelectorAll('.objectives-container button');
    const subjectDisplay = document.getElementById('subject-display');

    objectivesButtons.forEach(button => {
      button.addEventListener('click', () => {
        const category = button.getAttribute('data-category');
        const categorySubjects = subjectsByCategory[category] || [];
        if (categorySubjects.length > 0) {
          const randomIndex = Math.floor(Math.random() * categorySubjects.length);
          const chosenSubject = categorySubjects[randomIndex];
          subjectDisplay.textContent = chosenSubject;
        } else {
          subjectDisplay.textContent = "Pas de sujets dans cette catégorie pour l'instant.";
        }
      });
    });

    /* ========== Enregistrement vidéo ========== */
    let mediaRecorder;
    let recordedChunks = [];
    const preview = document.getElementById('preview');
    const playback = document.getElementById('playback');
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');
    const downloadLink = document.getElementById('download-link');
    const progressBarInner = document.getElementById('progress-bar-inner');
    const boxPartageRS = document.getElementById('box-partage-RS');
    const downloadSection = document.getElementById('download-section');
    const validateFormBtn = document.getElementById('validate-form-btn');
    const prenomInput = document.getElementById('prenom');
    const emailInput = document.getElementById('email');
    const downloadPdfBtn = document.getElementById('download-pdf-btn');

    let countdown;

    async function setupCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        preview.srcObject = stream;
        return stream;
      } catch (error) {
        if (error.name === 'NotAllowedError' || error.name === 'SecurityError') {
          statusText.textContent = "Vous avez refusé l'accès à la webcam et/ou au micro. Veuillez autoriser l'accès pour enregistrer une vidéo.";
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
          statusText.textContent = "Aucune caméra ou microphone n'a été trouvé(e). Vérifiez vos périphériques et réessayez.";
        } else {
          statusText.textContent = "Erreur : Impossible d'accéder à la webcam. Vérifiez vos permissions et/ou votre configuration.";
        }
        console.error('Erreur d\'accès à la webcam :', error);
        return null;
      }
    }

    function startTimer() {
      let timeRemaining = 120;
      progressBarInner.style.width = '0%';
      countdown = setInterval(() => {
        const progress = ((120 - timeRemaining) / 120) * 100;
        progressBarInner.style.width = `${progress}%`;
        timeRemaining--;
        if (timeRemaining < 0) {
          clearInterval(countdown);
          if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
          }
        }
      }, 1000);
    }

    startBtn.addEventListener('click', async () => {
      // Vérif compat
      if (typeof MediaRecorder === 'undefined' || !navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        statusText.textContent = "Désolé, l'enregistrement vidéo n'est pas supporté par votre navigateur.";
        return;
      }
      // Confirmation
      if (!confirm("Attention : votre webcam va se lancer pour démarrer l'improvisation. Voulez-vous continuer ? Pour information, la vidéo s'enregistre seulement en local sur votre appareil.")) {
        return;
      }

      const stream = await setupCamera();
      if (!stream) return; // en cas d'erreur d'accès

      if (!window.MediaRecorder || typeof MediaRecorder.isTypeSupported === 'undefined') {
        statusText.textContent = "Votre navigateur ne supporte pas l'enregistrement vidéo. Essayez avec Chrome, Firefox ou une version plus récente de Safari.";
        return;
      }

      mediaRecorder = new MediaRecorder(stream);
      recordedChunks = [];
      
      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          recordedChunks.push(event.data);
        }
      };
      
      mediaRecorder.onstop = () => {
        const videoBlob = new Blob(recordedChunks, { type: 'video/mp4' });
        const videoURL = URL.createObjectURL(videoBlob);
        playback.src = videoURL;
        playback.style.display = 'block';

        // On prépare le lien de DL (mais on ne l'affichera qu'après validation)
        downloadLink.href = videoURL;
        downloadLink.download = 'Letmotiv_Improvisation.mp4';

        // Arrête la webcam
        stream.getTracks().forEach((track) => track.stop());

        // On affiche la section avec le formulaire Prénom / Email
        downloadSection.classList.remove('hidden');

        // On affiche la box de partage LinkedIn
        boxPartageRS.style.display = 'block';
      };

      mediaRecorder.start();
      statusText.textContent = "Improvisation en cours...";
      startBtn.disabled = true;
      stopBtn.disabled = false;
      startTimer();
    });

    stopBtn.addEventListener('click', () => {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        statusText.textContent = "Improvisation terminée. Renseignez vos informations pour accéder au téléchargement.";
        startBtn.disabled = false;
        stopBtn.disabled = true;
        clearInterval(countdown);

        setTimeout(() => {
          playback.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 500);
      }
    });

    // Validation du formulaire (Prénom / Email)
    validateFormBtn.addEventListener('click', () => {
      const prenomValue = prenomInput.value.trim();
      const emailValue = emailInput.value.trim();

      if (!prenomValue || !emailValue) {
        alert("Merci de renseigner un prénom et un email pour continuer.");
        return;
      }
      // Si OK, on affiche le lien de téléchargement de la vidéo
      downloadLink.style.display = 'inline-block';
      validateFormBtn.disabled = true; // évite un nouveau clic, par exemple
    });

    // Bouton PDF
    downloadPdfBtn.addEventListener('click', () => {
      // Exemple PDF encodé en base64
      const base64PDF = "data:application/pdf;base64,JVBERi0xLjUNCiW1...";
      // Ou un simple link.href vers un fichier PDF sur ton serveur

      const link = document.createElement('a');
      link.href = base64PDF;  // Remplace par ton fichier PDF si besoin
      link.download = "Questions_Evaluation.pdf";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
  </script>
</body>
</html>
