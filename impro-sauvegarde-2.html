<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulateur d'improvisation</title>
  <meta name="description" content="Évaluer et développer rapidement votre niveau en prise de parole en public avec le simulateur d'improvisation Letmotiv.">

  <!-- Import de la police Sour Gummy depuis Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Sour+Gummy&display=swap"
    rel="stylesheet"
  />

  <!-- Icônes Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />

  <style>
    /* --- GLOBAL --- */
    body {
      margin: 0;
      font-family: Helvetica, Arial, sans-serif;
      background-color: #ffffff; /* Fond blanc */
      color: #333333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden; /* Empêche le défilement horizontal */
    }

    /* --- HEADER --- */
    .header {
      background-color: #182d84;
      color: #FFFFFF;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10;
      box-sizing: border-box;
    }
    .header-content {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      max-width: 100%;
      overflow-wrap: break-word; /* évite débordement si texte trop long */
    }
    .header-l1,
    .header-l2 {
      display: inline-block;
    }
    .header a {
      color: #FFFFFF;
      text-decoration: none;
    }
    .header a:hover {
      text-decoration: none;
    }

    @media (max-width: 600px) {
      .header-l1,
      .header-l2 {
        display: block;
      }
    }

    /* --- Titre principal (avec la police "Sour Gummy") --- */
    .main-title {
      margin-top: 80px; /* espace pour ne pas empiéter sur le header fixe */
      text-align: center;
      font-family: 'Sour Gummy', cursive; /* Police importée */
      font-size: 1.3rem; /* ajuste la taille si besoin */
      font-weight: bold;
      padding: 0 1rem;
    }

    /* --- BOXES : couleur de fond #E2E7E3, centrage, marges --- */
    .box0,
    .intro-box,
    .container,
    .box-partage-RS {
      width: 90%;
      max-width: 600px;
      margin: 20px auto; /* centrage horizontal + marge verticale */
      background-color: #E2E7E3; 
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 14px;
      border: 2px solid #eeeeee;
      position: relative;
    }

    /* Sous-titres de sections (mode d'emploi, etc.) */
    .section-subtitle {
      font-size: 16px;
      color: #000000;
      font-weight: bold;
      margin: 0 0 10px;
    }

    /* BOX0 : Mode d'emploi */
    .mode-emploi-toggle {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .mode-emploi-toggle i {
      transition: transform 0.3s;
      font-size: 18px;
    }
    .opened {
      transform: rotate(180deg);
    }
    .help-content {
      display: none;
      margin-top: 10px;
      background-color: #fefefe;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      text-align: left;
      font-size: 14px;
    }

    /* Liste des étapes avec icônes dans des ronds */
    .step-list {
      list-style: none; /* On enlève les puces par défaut */
      padding-left: 0;  
      margin: 0;
    }
    .step-list li {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      flex-wrap: nowrap; /* évite retour ligne sur icônes */
    }
    .step-icon {
      background-color: #00a48a; 
      border-radius: 50%;
      color: #fff;
      width: 32px;
      height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-size: 16px;
      flex-shrink: 0; /* empêche la pastille de se déformer sur mobile */
    }

    /* BOX1 : Choix d’objectif */
    .intro-box h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 16px;
      color: #000000;
      font-weight: bold;
    }
    .objectives-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    /* Bouton objectif sélectionné = vert */
    .selected-objective {
      background-color: #00a48a !important;
    }

    /* Encadré pour l'explication (texte centré et en gras) + animation */
    .explanation-box {
      /* On n'utilise pas display:none pour permettre la transition */
      visibility: hidden;    /* caché par défaut */
      opacity: 0;           /* transparent */
      transform: translateY(-10px);

      margin-top: 10px;
      background-color: #fefefe;
      border: 0 solid #ccc; /* part de 0px */
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      font-size: 14px;
      color: #333;

      /* On anime la bordure, l'opacité et la translation */
      transition: border 0.5s ease, opacity 0.5s ease, transform 0.5s ease;
    }
    .explanation-box.show {
      visibility: visible;   /* rend visible */
      opacity: 1;            /* opacité 1 */
      transform: translateY(0);
      border: 2px solid #ccc; /* la bordure passe de 0 à 2px */
    }

    /* BOX2 : Vidéo, enregistrement, etc. */
    .container .box-title {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 16px;
      color: #000000;
      font-weight: bold;
    }

    .subject-wrapper {
      margin-top: 10px;
      background-color: #fefefe;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      color: #333;
      display: none; /* caché tant qu'il n'y a pas de sujet */
    }
    .subject-wrapper span {
      font-weight: bold;
    }

    /* Encadré bleu + vidéo + boutons centrés */
    .video-box {
      margin: 10px auto;
      border: 3px solid #182d84;
      border-radius: 6px;
      max-width: 500px;
      background-color: #fefefe;
      height: 300px; /* on fixe une hauteur */
      position: relative;
      display: flex;
      justify-content: center;   /* centre horizontal */
      align-items: center;       /* centre vertical */
    }
    .video-box video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1; /* derrière le bouton */
    }
    .video-controls {
      z-index: 2; /* au-dessus de la vidéo */
    }

    #progress-bar {
      width: 100%;
      height: 10px;
      background-color: #e0e0e0;
      border-radius: 5px;
      margin-top: 10px;
      margin-bottom: 10px;
      overflow: hidden;
      position: relative;
      border: 2px solid #cccccc;
    }
    #progress-bar-inner {
      width: 0%;
      height: 100%;
      background-color: #00a48a;
      transition: width 0.5s linear;
    }

    button,
    a.btn {
      background-color: #182d84;
      color: #FFFFFF;
      font-family: Helvetica, Arial, sans-serif;
      font-size: 16px;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      cursor: pointer;
      margin: 5px;
      text-decoration: none;
      transition: background-color 0.3s, transform 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    button:hover,
    button:active,
    a.btn:hover,
    a.btn:active {
      background-color: #00a48a;
      transform: translateY(-3px);
    }

    .footer {
      background-color: #182d84;
      color: #FFFFFF;
      font-size: 16px;
      text-align: center;
      padding: 20px;
      width: 100%;
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    .footer-buttons a {
      display: inline-block;
      background-color: #FFFFFF;
      color: #182d84;
      border: 2px solid #182d84;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: bold;
      text-decoration: none;
      transition: background-color 0.3s, color 0.3s, transform 0.3s;
    }
    .footer-buttons a:hover,
    .footer-buttons a:active {
      background-color: #00a48a;
      color: #FFFFFF;
      transform: translateY(-3px);
    }

    .hidden {
      display: none;
    }

    .download-section {
      margin-top: 20px;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .download-section label {
      display: block;
      margin: 10px 0 5px;
    }
    .download-section input {
      padding: 8px;
      font-size: 14px;
      margin-bottom: 10px;
      width: 80%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    /* Nouvelle box pour les téléchargements */
    .downloads-box {
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      background-color: #E2E7E3; 
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 14px;
      border: 2px solid #eeeeee;
      position: relative;
    }
    .downloads-box h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 16px;
      color: #000000;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div class="header-content">
      <!-- L1 : Letmotiv + icône -->
      <div class="header-l1">
        <a href="https://www.letmotiv.fr" target="_blank">Letmotiv</a>
        <i class="fas fa-microphone"></i>
      </div>
      <!-- L2 : vide ou masqué -->
      <div class="header-l2"></div>
    </div>
  </div>

  <!-- Titre principal -->
  <h1 class="main-title">
    Entrainez-vous à la prise de parole en public avec le simulateur Letmotiv
  </h1>

  <!-- BOX0 : Mode d'emploi -->
  <div class="box0">
    <h3 class="section-subtitle mode-emploi-toggle" id="mode-emploi-toggle">
      Mode d'emploi <i class="fas fa-angle-down" id="arrow-icon"></i>
    </h3>

    <div class="help-content" id="help-content">
      <p>
        Vous voulez évaluer et développer votre niveau en prise de parole en public ? 
        Faites-le rapidement et gratuitement avec le simulateur d'improvisation Letmotiv : 
      </p>

      <!-- Liste avec icônes dans des ronds -->
      <ul class="step-list">
        <li>
          <span class="step-icon"><i class="fas fa-bullseye"></i></span>
          Sélectionnez un objectif.
        </li>
        <li>
          <span class="step-icon"><i class="fas fa-dice"></i></span>
          Générez un sujet d'improvisation aléatoire.
        </li>
        <li>
          <span class="step-icon"><i class="fas fa-video"></i></span>
          Lancez votre improvisation (2 minutes top chrono) et enregistrez-vous.
        </li>
        <li>
          <span class="step-icon"><i class="fas fa-download"></i></span>
          Indiquez votre prénom/email pour télécharger la vidéo et la grille d'évaluation.
        </li>
      </ul>
    </div>
  </div>

  <!-- BOX1 : Choix d'objectif -->
  <div class="intro-box">
    <h3>Quel est ton objectif de prise de parole&nbsp;?</h3>
    <div class="objectives-container">
      <button data-category="convaincre">Convaincre</button>
      <button data-category="inspirer">Inspirer</button>
      <button data-category="lacher-prise">Lâcher prise</button>
      <button data-category="toast">Porter un toast</button>
      <button data-category="repartie">Avoir de la répartie</button>
      <button data-category="vendre">Vendre</button>
      <button data-category="conflit">Gérer un conflit</button>
    </div>

    <!-- Encadré pour l'explication (transition bordure/opacité/position) -->
    <div class="explanation-box" id="explanation-box"></div>
  </div>

  <!-- BOX2 : Vidéo, enregistrement, etc. -->
  <div class="container">
    <h3 class="box-title">Lance ton impro&nbsp;!</h3>

    <!-- Bouton pour générer le sujet d'impro (selon l’objectif sélectionné) -->
    <button id="generate-subject-btn">Générer un sujet d'improvisation</button>

    <!-- Cadre blanc pour le sujet -->
    <div id="subject-wrapper" class="subject-wrapper">
      <span id="subject-display"></span>
    </div>

    <!-- Box vidéo + boutons centrés -->
    <div class="video-box">
      <video id="preview" autoplay muted></video>
      <div class="video-controls">
        <button id="start-btn"><i class="fas fa-video"></i> Démarrer ton impro</button>
        <button id="stop-btn" class="hidden"><i class="fas fa-stop"></i> Arrêter l'improvisation</button>
      </div>
    </div>

    <div id="progress-bar">
      <div id="progress-bar-inner"></div>
    </div>

    <p id="status">Sélectionnez un objectif puis cliquez sur « Générer un sujet ».</p>

    <!-- Formulaire prénom + email -->
    <div id="download-section" class="download-section hidden">
      <h3>Pour télécharger votre prestation et une grille d'analyse Letmotiv :</h3>
      <label for="prenom">Prénom :</label>
      <input type="text" id="prenom" placeholder="Votre prénom"/>

      <label for="email">Email :</label>
      <input type="email" id="email" placeholder="Votre email"/>

      <div>
        <button id="validate-form-btn">Valider</button>
      </div>
    </div>
  </div>

  <!-- Nouvelle box : Vos téléchargements (apparaît après validation) -->
  <div id="downloads-box" class="downloads-box hidden">
    <h3>Vos téléchargements</h3>
    <button id="download-video-btn" class="hidden">
      <i class="fas fa-download"></i> Télécharger la vidéo (mp4)
    </button>
    <button id="download-pdf-btn" class="hidden">
      <i class="fas fa-download"></i> Télécharger la grille d'évaluation (pdf)
    </button>
  </div>

  <!-- Partage sur les réseaux sociaux -->
  <div class="box-partage-RS hidden" id="box-partage-RS">
    <p>
      Partagez votre expérience et encouragez d'autres personnes à relever le défi. <br>
      Montrez votre courage et inspirez les autres à s'améliorer en improvisation !<br>
      <b>#ChallengeImproLetmotiv</b>
    </p>
    <a
      id="linkedin-share-button"
      href="https://www.linkedin.com/shareArticle?mini=true&url=https://citizen11bf.github.io/simulation-impro/letmotiv.html"
      target="_blank"
      class="linkedin-share-button"
    >
      <i class="fab fa-linkedin"></i> Partager sur LinkedIn
    </a>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <p>Vous souhaitez progresser rapidement et efficacement dans la prise de parole en public&nbsp;?</p>
    <div class="footer-buttons">
      <a
        href="https://www.letmotiv.fr/offres-particulier/coaching-prise-de-parole"
        target="_blank"
      >
        <i class="fas fa-chalkboard-teacher"></i> Réservez un coaching Letmotiv
      </a>
      <a
        href="https://alexetpierre.systeme.io/inscription"
        target="_blank"
      >
        <i class="fas fa-laptop"></i> Suivre la formation en ligne Letmotiv
      </a>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    /**************************
     * 1) Mode d'emploi toggle
     **************************/
    const modeEmploiToggle = document.getElementById('mode-emploi-toggle');
    const arrowIcon = document.getElementById('arrow-icon');
    const helpContent = document.getElementById('help-content');

    modeEmploiToggle.addEventListener('click', () => {
      if (helpContent.style.display === 'none' || helpContent.style.display === '') {
        helpContent.style.display = 'block';
        arrowIcon.classList.add('opened'); // rotation
      } else {
        helpContent.style.display = 'none';
        arrowIcon.classList.remove('opened');
      }
    });

    /**************************
     * 2) Explications par catégorie
     **************************/
    const explanations = {
      convaincre:   "Objectif : essaye de convaincre ton auditoire d’une idée générale.",
      inspirer:     "Objectif : fais un discours inspirant et motive ton public.",
      'lacher-prise': "Objectif : amuse-toi, libère-toi de tes freins et lâche prise.",
      toast:        "Objectif : porter un toast marquant pour célébrer un événement.",
      repartie:     "Objectif : réponds du tac-au-tac et montre ton sens de la répartie.",
      vendre:       "Objectif : fais un argumentaire de vente percutant.",
      conflit:      "Objectif : gère un désaccord ou une tension avec diplomatie."
    };

    const txtFilesByCategory = {
      convaincre:   "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/convaincre.txt",
      inspirer:     "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/inspirer.txt",
      'lacher-prise': "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/lacher_prise.txt",
      toast:        "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/toast.txt",
      repartie:     "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/repartie.txt",
      vendre:       "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/vendre.txt",
      conflit:      "https://raw.githubusercontent.com/Citizen11bf/letmotiv/data/gerer_un_conflit.txt"
    };

    let subjectsCache = {
      convaincre: null,
      inspirer: null,
      'lacher-prise': null,
      toast: null,
      repartie: null,
      vendre: null,
      conflit: null
    };

    const objectivesButtons = document.querySelectorAll('.objectives-container button');
    const explanationBox = document.getElementById('explanation-box');
    const header = document.querySelector('.header'); // pour le scroll offset
    let currentCategory = null; // la catégorie en cours

    objectivesButtons.forEach(button => {
      button.addEventListener('click', async () => {
        // Retire la classe "selected-objective" de tous les boutons
        objectivesButtons.forEach(btn => btn.classList.remove('selected-objective'));

        // Ajoute la classe "selected-objective" au bouton cliqué
        button.classList.add('selected-objective');

        currentCategory = button.dataset.category;
        const explication = explanations[currentCategory] || "";

        // Animer l'explanation box (bordure + fade)
        explanationBox.textContent = explication;
        explanationBox.classList.add('show');   // applique .show
       
        // On pré-charge déjà les sujets .txt pour éviter d'attendre plus tard
        if (subjectsCache[currentCategory] === null) {
          await loadSubjects(currentCategory);
        }

        // On attend 2 secondes de lecture + animation, puis scroll
        setTimeout(() => {
          // Scroll manuel pour compenser la hauteur du header
          const box2 = document.querySelector('.container');
          const headerHeight = header ? header.offsetHeight : 0;

          if (box2) {
            const box2Y = box2.getBoundingClientRect().top + window.scrollY - headerHeight - 10;
            window.scrollTo({
              top: box2Y,
              behavior: 'smooth'
            });
          }
        }, 2000);
      });
    });

    async function loadSubjects(category) {
      const filePath = txtFilesByCategory[category];
      if (!filePath) {
        console.error("Catégorie inconnue ou chemin manquant:", category);
        return [];
      }
      try {
        const response = await fetch(filePath);
        if (!response.ok) {
          console.error("Erreur lors du fetch du fichier : " + filePath);
          return [];
        }
        const text = await response.text();
        const lines = text
          .split('\n')
          .map(l => l.trim())
          .filter(l => l.length > 0);
        subjectsCache[category] = lines;
        return lines;
      } catch (err) {
        console.error("Erreur fetch: ", err);
        return [];
      }
    }

    const generateSubjectBtn = document.getElementById('generate-subject-btn');
    const subjectWrapper = document.getElementById('subject-wrapper');
    const subjectDisplay = document.getElementById('subject-display');
    let currentSubject = "";

    generateSubjectBtn.addEventListener('click', () => {
      if (!currentCategory) {
        alert("Merci de sélectionner d'abord un objectif.");
        return;
      }
      const subjects = subjectsCache[currentCategory];
      if (!subjects || subjects.length === 0) {
        subjectDisplay.textContent = "Pas de sujets disponibles ou erreur de chargement.";
        subjectWrapper.style.display = 'block';
        currentSubject = "";
        return;
      }
      const randomIndex = Math.floor(Math.random() * subjects.length);
      currentSubject = subjects[randomIndex];

      subjectDisplay.textContent = currentSubject;
      subjectWrapper.style.display = 'block';
    });

    /**************************
     * Enregistrement vidéo
     **************************/
    let mediaRecorder;
    let recordedChunks = [];
    const preview = document.getElementById('preview');
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');
    const progressBarInner = document.getElementById('progress-bar-inner');
    const statusText = document.getElementById('status');
    const boxPartageRS = document.getElementById('box-partage-RS');

    const downloadSection = document.getElementById('download-section');
    const validateFormBtn = document.getElementById('validate-form-btn');
    const prenomInput = document.getElementById('prenom');
    const emailInput = document.getElementById('email');

    const downloadsBox = document.getElementById('downloads-box');
    const downloadVideoBtn = document.getElementById('download-video-btn');
    const downloadPdfBtn = document.getElementById('download-pdf-btn');

    let countdown;
    let videoURL = "";

    async function setupCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        preview.srcObject = stream;
        return stream;
      } catch (error) {
        if (error.name === 'NotAllowedError' || error.name === 'SecurityError') {
          statusText.textContent = "Vous avez refusé l'accès à la webcam ou au micro. Veuillez autoriser l'accès.";
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
          statusText.textContent = "Aucune caméra ou micro détecté(e). Vérifiez vos périphériques.";
        } else {
          statusText.textContent = "Erreur : Impossible d'accéder à la webcam. Vérifiez vos permissions.";
        }
        console.error('Erreur d\'accès à la webcam :', error);
        return null;
      }
    }

    function startTimer() {
      let timeRemaining = 120; // 2 minutes
      progressBarInner.style.width = '0%';
      countdown = setInterval(() => {
        const progress = ((120 - timeRemaining) / 120) * 100;
        progressBarInner.style.width = `${progress}%`;
        timeRemaining--;
        if (timeRemaining < 0) {
          clearInterval(countdown);
          if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
          }
        }
      }, 1000);
    }

    startBtn.addEventListener('click', async () => {
      if (!currentSubject) {
        alert("Merci de sélectionner un objectif et de générer un sujet avant de démarrer.");
        return;
      }
      if (typeof MediaRecorder === 'undefined' || !navigator.mediaDevices?.getUserMedia) {
        statusText.textContent = "Désolé, l'enregistrement vidéo n'est pas supporté par votre navigateur.";
        return;
      }
      if (!confirm("Votre webcam va se lancer pour démarrer l'improvisation. Voulez-vous continuer ?")) {
        return;
      }

      const stream = await setupCamera();
      if (!stream) return;

      if (!window.MediaRecorder || typeof MediaRecorder.isTypeSupported === 'undefined') {
        statusText.textContent = "Votre navigateur ne supporte pas l'enregistrement vidéo. Essayez Chrome/Firefox.";
        return;
      }

      mediaRecorder = new MediaRecorder(stream);
      recordedChunks = [];

      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          recordedChunks.push(event.data);
        }
      };

      mediaRecorder.onstop = () => {
        const videoBlob = new Blob(recordedChunks, { type: 'video/mp4' });
        videoURL = URL.createObjectURL(videoBlob);

        // Arrête la webcam
        stream.getTracks().forEach((track) => track.stop());

        // Affiche la section de formulaire
        downloadSection.classList.remove('hidden');
        // Affiche la box de partage
        boxPartageRS.classList.remove('hidden');
      };

      mediaRecorder.start();
      statusText.textContent = "Improvisation en cours...";

      startBtn.disabled = true;
      stopBtn.classList.remove('hidden');
      stopBtn.disabled = false;
      startTimer();
    });

    stopBtn.addEventListener('click', () => {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        statusText.textContent = "Improvisation terminée. Renseignez vos informations pour télécharger.";
        startBtn.disabled = false;
        stopBtn.disabled = true;
        stopBtn.classList.add('hidden');
        clearInterval(countdown);
      }
    });

    // Validation du formulaire -> affichage "Vos téléchargements"
    validateFormBtn.addEventListener('click', () => {
      const prenomValue = prenomInput.value.trim();
      const emailValue = emailInput.value.trim();

      if (!prenomValue || !emailValue) {
        alert("Merci de renseigner un prénom et un email pour continuer.");
        return;
      }

      downloadsBox.classList.remove('hidden');
      downloadVideoBtn.classList.remove('hidden');
      downloadPdfBtn.classList.remove('hidden');
      validateFormBtn.disabled = true;
    });

    downloadVideoBtn.addEventListener('click', () => {
      if (!videoURL) {
        alert("La vidéo n'est pas encore prête ou pas enregistrée.");
        return;
      }
      const link = document.createElement('a');
      link.href = videoURL;
      link.download = 'Letmotiv_Improvisation.mp4';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    downloadPdfBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.href = "https://drive.google.com/uc?export=download&id=1pKif7hwkdSQRXLv6uoSQawCs3DIIcb70";
      link.download = "Questions_Evaluation.pdf";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
  </script>
</body>
</html>
